The basis of this patch was pulled directly from the Free Range Routing
GIT Repository. The FRR project is a fork of the Quagga project and the project
as a whole and the bgp_packet.c file in particular continue to be covered by
the GPL 2.0 license, as Quagga was before it.

This original commit to the FRR project is available at the URL
https://github.com/FRRouting/frr/commit/ff6db1027f8f36df657ff2e5ea167773752537ed

This patch fixes the issue reported as cve-2022-37032.

--- bgpd/bgp_packet.c
+++ bgpd/bgp_packet.c
@@ -2162,7 +2162,12 @@ bgp_capability_msg_parse (struct peer *p
       if (BGP_DEBUG (normal, NORMAL))
 	zlog_debug ("%s CAPABILITY has action: %d, code: %u, length %u",
 		   peer->host, action, hdr->code, hdr->length);
-
+      if (hdr->length < sizeof(struct capability_mp_data)) {
+	zlog_info ("%s Capability structure not properly filled out, expected "
+	    "at least %zu bytes but header length specified is %d",
+	    peer->host, sizeof(struct capability_mp_data), hdr->length);
+	return -1;
+      }
       /* Capability length check. */
       if ((pnt + hdr->length + 3) > end)
         {
